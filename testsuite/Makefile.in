CHECK = basic
TESTTARGETS := $(patsubst %,tst_%,$(CHECK))

srcdir = @srcdir@
top_builddir = ..
distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
subdir = testsuite
VPATH = @srcdir@
SHELL = @SHELL@

CXX = @CXX@
EXTRAOPTS = @EXTRAOPTS@
DEBUGOPTS = @DEBUGOPTS@
WARNOPTS = @WARNOPTS@
DEFS = -DHAVE_CONFIG_H -DDEBUG
CXXFLAGS = $(DEBUGOPTS) $(EXTRAOPTS) $(WARNOPTS)
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = $(top_builddir)/.libs/libcwd.so @LIBS@ -Wl,--rpath,$(top_builddir)/.libs
INCLUDES = -I- -I$(top_builddir)/include -I$(srcdir)/../include
PACKAGE = @PACKAGE@
VERSION = @VERSION@
DISTFILES = Makefile.in config lib libcwd.tests

CXXCOMPILE = $(CXX) $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CXXFLAGS)
CXXLINK = $(CXX) $(CXXFLAGS) $(LDFLAGS) -o $@

all:
info install-info clean-info dvi install etags tags installcheck:

site.exp: Makefile
	@echo "Making a new config file..."
	-@rm -f ./tmp?
	@touch site.exp
	-@mv site.exp site.bak
	@echo "## these variables are automatically generated by make ##" > ./tmp0
	@echo "# Do not edit here. If you wish to override these values" >> ./tmp0
	@echo "# add them to the last section" >> ./tmp0
	@echo "set srcdir $(srcdir)" >> ./tmp0
	@echo "set tool libcwd" >> ./tmp0
	@echo "set libcwd \"$(LIBS)\"" >> ./tmp0
	@echo "set TOOL_OPTIONS \"$(INCLUDES)\"" >> ./tmp0
	@echo "## All variables above are generated by configure. Do Not Edit ##" >> ./tmp0
	@cat ./tmp0 > site.exp
	@cat site.bak | sed -e '1,/^## All variables above are.*##/ d' >> site.exp
	-@rm -f ./tmp?

check: site.exp
	srcdir=$(srcdir); export srcdir; runtest

tst_%.o: %.cc
	$(CXXCOMPILE) -c $< -o $@

tst_%: tst_%.o
	$(CXXLINK) $(LDFLAGS) $@.o $(LIBS)

# Clean rules
mostlyclean:
	rm -f site.bak
clean: mostlyclean
	rm -f libcwd.log libcwd.sum $(TESTTARGETS) *.o
distclean: clean
	rm -f Makefile site.exp

distdir: $(DISTFILES)
	distdir=`cd $(distdir) && pwd`;
	@for file in $(DISTFILES); do \
	  d=$(srcdir); \
	  if test -d $$d/$$file; then \
	    cp -pr $$d/$$file $(distdir)/$$file; \
	  else \
	    test -f $(distdir)/$$file \
	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
	    || cp -p $$d/$$file $(distdir)/$$file || :; \
	  fi; \
	done

# Maintainer rules
maintainer-clean realclean: distclean

Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
	cd $(top_builddir) \
	  && CONFIG_FILES=testsuite/Makefile CONFIG_HEADERS= $(SHELL) ./config.status
